# üõ°Ô∏è –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ RSS v2.0

## üìã –û–±–∑–æ—Ä

–ù–æ–≤–∞—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ RSS –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ø—Ä–æ–±–ª–µ–º –∏ –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

## üîß –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. **ErrorManager** (`core/error_manager.py`)
–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∞–º–∏:
- ‚úÖ –°—á–µ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `rss_errors.log`
- ‚úÖ –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è 403 –æ—à–∏–±–æ–∫
- ‚úÖ –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### 2. **RSS Error Viewer** (`rss_error_viewer.py`)
–£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ –æ—à–∏–±–æ–∫:
```bash
python3 rss_error_viewer.py           # –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç
python3 rss_error_viewer.py log 50    # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 –∑–∞–ø–∏—Å–µ–π
python3 rss_error_viewer.py export    # –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
python3 rss_error_viewer.py help      # –°–ø—Ä–∞–≤–∫–∞
```

### 3. **Health Check** (`check_rss_health.sh`)
–ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã:
```bash
./check_rss_health.sh                 # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã
```

## üö® –¢–∏–ø—ã –æ—à–∏–±–æ–∫ –∏ —Ä–µ–∞–∫—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã

### **HTTP 403 Forbidden** - –£–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
```
–û—à–∏–±–∫–∞ 1-2: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è "user_agent" ‚Üí –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π User-Agent
–û—à–∏–±–∫–∞ 3-4: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è "proxy" ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏
–û—à–∏–±–∫–∞ 5+:  –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è "both" ‚Üí –ø—Ä–æ–∫—Å–∏ + User-Agent
```

### **HTTP 404 Not Found** - –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
- –ò—Å—Ç–æ—á–Ω–∏–∫ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –æ—à–∏–±–∫–∏
- –ü–∞—Ä—Å–∏–Ω–≥ –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç—Å—è (return 0)
- –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è URL

### **–¢–∞–π–º–∞—É—Ç—ã –∏ —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏** - –†–µ—Ç—Ä–∞–∏
- 3 –ø–æ–ø—ã—Ç–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏: 2s ‚Üí 4s ‚Üí 8s
- –ü—Ä–∏ –∏—Å—á–µ—Ä–ø–∞–Ω–∏–∏ –ø–æ–ø—ã—Ç–æ–∫ - –∑–∞–ø–∏—Å—å –≤ –æ—à–∏–±–∫–∏
- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É —Ü–∏–∫–ª–∞–º–∏

### **–û—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞** - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

## üìä –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–ø—É—Å–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

```python
if error_count >= 5:
    delay_minutes = min(60, 2 ** error_count)
    # 2^5=32–º–∏–Ω, 2^6=60–º–∏–Ω (–º–∞–∫—Å), 2^7=60–º–∏–Ω...
```

**–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ –≤—Å–µ —Å—á–µ—Ç—á–∏–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è

## üìÅ –§–∞–π–ª—ã –ª–æ–≥–æ–≤

### **rss_errors.log** - –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏
```
2025-07-26 21:16:53 | ERROR | Test Feed | forbidden | HTTP 403 | Test 403 error | –û—à–∏–±–æ–∫: 1
```

### **rss_core.log** - –û–±—â–∏–π –ª–æ–≥ –ø–∞—Ä—Å–µ—Ä–∞
```
üì° –ù–∞—á–∏–Ω–∞—é –ø–∞—Ä—Å–∏–Ω–≥ 46 –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤...
‚úÖ SciTechDaily Earth: 2 –Ω–æ–≤—ã—Ö
```

### **user_service.log** - –õ–æ–≥ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```
–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å—Ç–∞—Ç–µ–π: 15 –¥–ª—è eco_scan_bot
```

## üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```bash
tail -f rss_errors.log                # –û—à–∏–±–∫–∏ RSS
tail -f rss_core.log                  # –ü–∞—Ä—Å–∏–Ω–≥
tail -f user_service.log              # –û—Ç–ø—Ä–∞–≤–∫–∞
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º
```bash
./check_rss_health.sh                 # –û–±—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
python3 rss_error_viewer.py           # –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
grep "403\|timeout" rss_errors.log    # –ü–æ–∏—Å–∫ –ø—Ä–æ–±–ª–µ–º
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑ –ë–î
```bash
sqlite3 rss_media_bus.db "
SELECT feed_id, COUNT(*) 
FROM articles 
WHERE added_date > datetime('now', '-1 hour') 
GROUP BY feed_id ORDER BY COUNT(*) DESC;"
```

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º

### **403 –æ—à–∏–±–∫–∏**
1. **–í sources.yaml –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–∫—Å–∏:**
```yaml
source_name.com:
  url: "https://example.com/rss"
  active: true
  proxy_required: true
  proxy_settings:
    type: "http"
    url: "http://user:pass@proxy:port"
    region: "usa"
```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å User-Agent –≤ AsyncRSSParser**
3. **–í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å: `active: false`**

### **–¢–∞–π–º–∞—É—Ç—ã**
1. **–£–≤–µ–ª–∏—á–∏—Ç—å timeout –≤ `config.py`:**
```python
HTTP_TIMEOUT = 60  # –≤–º–µ—Å—Ç–æ 30
```

2. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–∫—Å–∏ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏**

### **404 –æ—à–∏–±–∫–∏**
1. **–ù–∞–π—Ç–∏ –Ω–æ–≤—ã–π URL RSS –Ω–∞ —Å–∞–π—Ç–µ**
2. **–û–±–Ω–æ–≤–∏—Ç—å URL –≤ sources.yaml**
3. **–ò–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å: `active: false`**

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã

### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –∞–ª–µ—Ä—Ç–∞
```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ crontab –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
*/5 * * * * cd /opt/rss_media_bus && python3 -c "
from core.error_manager import ErrorManager
from core.database import DatabaseManager
import sys

db = DatabaseManager()
error_mgr = ErrorManager(db)
stats = error_mgr.get_error_statistics()

if stats['total_errors'] > 10:
    print(f'ALERT: {stats[\"total_errors\"]} –æ—à–∏–±–æ–∫ RSS!')
    sys.exit(1)
"
```

### Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```python
# –î–æ–±–∞–≤–∏—Ç—å –≤ ErrorManager –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Slack/Discord
def send_critical_alert(self, error_count):
    if error_count > 5:
        # –û—Ç–ø—Ä–∞–≤–∏—Ç—å webhook
        pass
```

## üéõÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ ErrorManager
```python
max_errors = 5           # –ü–æ—Ä–æ–≥ –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
max_delay_minutes = 60   # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
log_retention = 10       # –•—Ä–∞–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –æ—à–∏–±–æ–∫
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram
```python
# –í user_notification_service.py –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å
if error_count > threshold:
    await send_admin_notification(f"–ò—Å—Ç–æ—á–Ω–∏–∫ {feed_name} –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω")
```

## üìö API ErrorManager

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã
```python
error_manager.record_error(url, name, type, status, message)
error_manager.reset_errors(url)
should_skip, reason = error_manager.should_skip_feed(url)
recommendation = error_manager.should_try_alternative_method(url, 403)
stats = error_manager.get_error_statistics()
```

---

**üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞:** –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Å–∏—Å—Ç–µ–º–æ–π –æ—à–∏–±–æ–∫ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `./check_rss_health.sh` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏. 